<app-blank pageName="Hastalar">
  <section class="content">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Hastalar</h3>
        <div class="card-tools">
          <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
            <i class="fas fa-minus"></i>
          </button>
          <button type="button" class="btn btn-tool" data-card-widget="remove" title="Remove">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>


      <div class="card-body p-0" style="display: block">
        <div class="row mb-3 mt-3">
          <div class="col-md-4 col-sm-12 mb-2">
            <select class="form-control">
              <option value="">Bölüme Göre Filtrele</option>
              <option value="kardiyoloji">Kardiyoloji</option>
              <option value="ortopedi">Ortopedi</option>
              <!-- Diğer bölümler -->
            </select>
          </div>
          <div class="col-md-4 col-sm-12 mb-2">
            <select class="form-control">
              <option value="">Ünvana Göre Filtrele</option>
              <option value="prof">Profesör</option>
              <option value="doc">Doçent</option>
              <!-- Diğer unvanlar -->
            </select>
          </div>
          <div class="col-md-4 col-sm-12">
            <input type="text" class="form-control" placeholder="Doktor Ara">
          </div>
        </div>

        <table class="table table-striped table-hover projects">
          <thead>
            <tr>
              <th style="width: 1%" >#</th>
              <th style="width: 20%">Hasta Adı</th>
              <th style="width: 15%">Resim</th>
              <th style="width: 15%">Yaş</th>
              <th style="width: 15%">Telefon Numarası</th>
              <th style="width: 8%" class="text-center">Durum</th>
              <th style="width: 30%"></th>
            </tr>
          </thead>
          <tbody>
            @if(patients?.items.length > 0) {
              @for (item of patients?.items; track $index) {
                <tr>
                  <td>#</td>
                  <td>
                    <a> {{item.firstName + ' ' + item.lastName}}</a>
                    <br />
                    <small> {{item.genderName}} </small>
                  </td>
                  <td>
                    <ul class="list-inline">
                      <li class="list-inline-item">
                        <img alt="Avatar" class="table-avatar" src="https://avatars.githubusercontent.com/u/71379630?v=4" />
                      </li>
                    </ul>
                  </td>
                  <td>
                    <a> {{calculateAge(item.birthDate.toString())}}</a>
                  </td>
                  <td>
                    <a>{{item.phoneNumber}}</a>
                  </td>
                  <td class="project-state">
                    <span class="badge" [ngClass]="!item.isDeleted ? 'badge-success' : 'badge-danger'">{{ !item.isDeleted ? 'Aktif' : 'Pasif' }}</span>
                  </td>
                  <td class="project-actions text-right">
                    <button type="button" class="btn btn-primary btn-sm" [routerLink]="'/admin/patient-details/' + item.id">
                      <i class="fas fa-circle-info"> </i>
                      Detay
                    </button>
                    <button class="btn btn-info btn-sm" data-toggle="modal" data-target="#updateModalLabel" (click)="getPatientDetail(item.id)">
                      <i class="fas fa-pencil-alt"> </i>
                      Düzenle
                    </button>
                    <button type="button" class="btn btn-danger btn-sm" href="#">
                      <i class="fas fa-trash"> </i>
                      Sil
                    </button>
                  </td>
                </tr>
              }
            }
            @else {
              <div class="alert alert-info">Mevcut hasta yok.</div>
           }
          </tbody>
          <button class="btn btn-outline-success m-3" data-toggle="modal" data-target="#addModal">Ekle</button>
        </table>


      </div>
      <div class="card-footer">
        <nav aria-label="Contacts Page Navigation">
          <ul class="pagination justify-content-center m-0">
            <li class="page-item"><a class="page-link" href="#">&laquo;</a></li>
            <li class="page-item"><a class="page-link" href="#">1</a></li>
            <li class="page-item"><a class="page-link" href="#">2</a></li>
            <li class="page-item"><a class="page-link" href="#">3</a></li>
            <li class="page-item"><a class="page-link" href="#">&raquo;</a></li>
          </ul>
        </nav>
      </div>
    </div>

    <!-- Add/Edit Modal -->
    <div class="modal fade" id="updateModalLabel" tabindex="-1" role="dialog" aria-labelledby="addModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <form class="form-horizontal" [formGroup]="patientEditForm">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addModalLabel">Hasta Düzenle</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="form-group row">
                <label for="firstName" class="col-sm-2 col-form-label">Ad</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="firstName" placeholder="İsim" formControlName="firstName" [appValid]="firstName.valid" />
                  <div *ngIf="firstName.invalid && (firstName.dirty || firstName.touched)" class="invalid-feedback">
                    <div *ngIf="firstName.errors?.required">{{ validationMessages.patientEdit.firstName.required }}</div>
                    <div *ngIf="firstName.errors?.minlength">{{ validationMessages.patientEdit.firstName.minlength }}</div>
                    <div *ngIf="firstName.errors?.maxlength">{{ validationMessages.patientEdit.firstName.maxlength }}</div>
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <label for="lastName" class="col-sm-2 col-form-label">Soyad</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="lastName" placeholder="Soyisim" formControlName="lastName" [appValid]="lastName.valid" />
                  <div *ngIf="lastName.invalid && (lastName.dirty || lastName.touched)" class="invalid-feedback">
                    <div *ngIf="lastName.errors?.required">{{ validationMessages.patientEdit.lastName.required }}</div>
                    <div *ngIf="lastName.errors?.minlength">{{ validationMessages.patientEdit.lastName.minlength }}</div>
                    <div *ngIf="lastName.errors?.maxlength">{{ validationMessages.patientEdit.lastName.maxlength }}</div>
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <label for="bloodType" class="col-sm-2 col-form-label">Kan Grubu</label>
                <div class="col-sm-10">
                  <select class="form-control" formControlName="bloodTypeId" [appValid]="bloodType.valid">
                    <option value="1">A+</option>
                    <option value="2">A-</option>
                    <option value="3">B+</option>
                    <option value="4">B-</option>
                    <option value="5">AB+</option>
                    <option value="6">AB-</option>
                    <option value="7">O+</option>
                    <option value="8">O-</option>
                  </select>
                  <div *ngIf="bloodType.invalid && (bloodType.dirty || bloodType.touched)" class="invalid-feedback">
                    <div *ngIf="bloodType.errors?.required">{{ validationMessages.register.bloodType.required }}</div>
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <label for="phone" class="col-sm-2 col-form-label">Telefon Numarası</label>
                <div class="col-sm-10">
                  <input type="tel" class="form-control" id="phone" placeholder="Telefon" formControlName="phoneNumber" [appValid]="phoneNumber.valid" />
                  <div *ngIf="phoneNumber.invalid && (phoneNumber.dirty || phoneNumber.touched)" class="invalid-feedback">
                    <div *ngIf="phoneNumber.errors?.required">{{ validationMessages.patientEdit.phoneNumber.required }}</div>
                    <div *ngIf="phoneNumber.errors?.phoneNumber">{{ validationMessages.patientEdit.phoneNumber.checkPhone }}</div>
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <label for="birthday" class="col-sm-2 col-form-label">Doğum Tarihi</label>
                <div class="col-sm-10">
                  <input type="date" class="form-control" id="birthday" placeholder="Doğum Tarihi" formControlName="birthDate" [appValid]="birthDate.valid" />
                  <div *ngIf="birthDate.invalid && (birthDate.dirty || birthDate.touched)" class="invalid-feedback">
                    <div *ngIf="birthDate.errors?.required">{{ validationMessages.register.birthDate.required }}</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <div class="col-sm-6 text-left">
                <button type="submit" class="btn btn-primary" data-dismiss="modal" aria-label="Close" (click)="update()">Güncelle</button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
    <!-- Patient Edit -->
  </section>
</app-blank>
